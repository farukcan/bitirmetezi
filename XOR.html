<html>
<head>
    <title>Yapay  Sinir Ağları</title>
</head>
<body>


<script src="js/lib/ANN.js"></script>
<script src="js/lib/evolution.js"></script>

<script>

    /* ------------------------------------------

            ILK ÇÖZÜMÜN KROMOZOMU

     */
    var exampleWeightGene = new Gene().TYPE(GA.TYPE.BIPOLAR);
    var chromosomeOfEve = new Chromosome().VAL({
        /* input sayısı : sabit */
        inputNN : new Gene().TYPE(GA.TYPE.INT).VAL(2).CHG(false),

        /* output sayısı : sabit */
        outputNN : new Gene().TYPE(GA.TYPE.INT).VAL(1).CHG(false),

        /* gizli katmanları sinir sayılarının dizisi */
        hiddenNN : new Chromosome().VAL([
            new Gene().TYPE(GA.TYPE.INT).MIN(1).MAX(10).VAL(2),
            new Gene().TYPE(GA.TYPE.INT).MIN(1).MAX(10).VAL(2),
        ]),

        /* ağın ağırlık matrislerinin dizisi */
        W : new Chromosome().VAL([ // ağırlık matislerinin dizisi
            new Chromosome().VAL([ // 3x2lik ağırlık matrisi
                new Chromosome().VAL([
                    GA.copyGene(exampleWeightGene).VAL(),
                    GA.copyGene(exampleWeightGene).VAL()
                ]),
                new Chromosome().VAL([
                    GA.copyGene(exampleWeightGene).VAL(),
                    GA.copyGene(exampleWeightGene).VAL()
                ]),
                new Chromosome().VAL([
                    GA.copyGene(exampleWeightGene).VAL(),
                    GA.copyGene(exampleWeightGene).VAL()
                ])
            ]),
            new Chromosome().VAL([ // 3x1lik ağırlık matrisi
                new Chromosome().VAL([
                    GA.copyGene(exampleWeightGene).VAL()
                ]),
                new Chromosome().VAL([
                    GA.copyGene(exampleWeightGene).VAL()
                ]),
                new Chromosome().VAL([
                    GA.copyGene(exampleWeightGene).VAL()
                ])
            ])
        ])
    }).RULE(function(val){
        /* Mutasyon ve Çaprazlama sonrası kromozomu onarma ve yönetmeyle sorunlu fonksiyondur.

         /* genin yapısı hakkında veri toplama */

        var inputNN = val.inputNN.val;
        var outputNN = val.outputNN.val;
        var hiddenNN = val.hiddenNN.toJSON();
        var wMatrixCount = hiddenNN.length+1;
        var layers = [];
        layers.push(inputNN);
        layers = layers.concat(hiddenNN);
        layers.push(outputNN);

        /* ### onarma işlemleri */

        /* # matris sayısını onarma */
        while(val.W.val.length < wMatrixCount){
            // mevcut ağırlık matrisi sayısı olması gerekenden düşükse
            GA.INS(val.W.val); // matris sayısını arttır
        }
        while(val.W.val.length > wMatrixCount){
            // mevcut ağırlık matrisi sayısı olması gerekenden düşükse
            GA.RMV(val.W.val); // matris sayısını azalt
        }

        /* # satır sayılarını onarma */
        val.W.val.forEach(function(matrisGene,matrisIndex){
            // her bir matris için
            var rowNum = layers[matrisIndex]+1;

            while(matrisGene.val.length < rowNum){
                GA.INS(matrisGene.val); // satır sayısını arttır
            }

            while(matrisGene.val.length > rowNum){
                GA.RMV(matrisGene.val); // satır sayısını azalt
            }
        });

        /* sutun sayılarını onarma */
        val.W.val.forEach(function(matrisGene,matrisIndex){
            // her bir matris için
            var columnNum = layers[matrisIndex+1];
            matrisGene.val.forEach(function(rowGene,rowIndex){
                // her satır için

                while(rowGene.val.length < columnNum){
                    GA.INS(rowGene.val); // sutun sayısını arttır
                }

                while(rowGene.val.length > columnNum){
                    GA.RMV(rowGene.val); // sutun sayısını azalt
                }
            });
        });

    });


    /*

            EVRIMSEL SÜREÇ

     */

    var fitnessFonksiyonu = function(member){
        var outs = [];
        var beklenen = [0,1,1,0];
        var genetic = member.chromosome.toJSON();

        member.ysa = new ANN().PERCEPTRON(genetic.inputNN,genetic.hiddenNN,genetic.outputNN).setBias([-1,-1]);
        YSA.setWeights(genetic.W);

        member.ysa.fire([0,0]);
        outs.push(member.getOutputs()[0]);
        member.ysa.fire([0,1]);
        outs.push(member.getOutputs()[0]);
        member.ysa.fire([1,0]);
        outs.push(member.getOutputs()[0]);
        member.ysa.fire([1,1]);
        outs.push(member.getOutputs()[0]);

        var hata= 0;
        for(var i=0; i < beklenen.length ; i++){
            hata+=(outs[i]-beklenen[i])*(outs[i]-beklenen[i]);
        }
        member.fitness = 16 - hata;

        return member.fitness;
    };

    var baslangicFonksiyonu = function(population_size){
            new Population(this);

            while(population_size--){
                var newMember = new Member(this.population);
                newMember.chromosome = GA.copyGene(chromosomeOfEve);
                newMember.chromosome.mutate();
            }
    };

    var evrim = new Evolotion(fitnessFonksiyonu,baslangicFonksiyonu);

    evrim.setParameters({
        algorithm : GA.ALGORITHMS.STANDART,
        iterations : 100
    });

    evrim.start();


</script>

</body>
</html>